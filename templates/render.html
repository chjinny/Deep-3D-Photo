<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Colorlib Templates">
    <meta name="author" content="Colorlib">
    <meta name="keywords" content="Colorlib Templates">

    <!-- Title Page-->
    <title>Live Photo!</title>

    <!-- Icons font CSS-->
    <link href="static/vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">
    <link href="static/vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <!-- Font special for pages-->
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

    <!-- Vendor CSS-->
    <link href="static/vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="static/vendor/datepicker/daterangepicker.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="static/css/main.css" rel="stylesheet" media="all">
</head>

<body>
    <div class="page-wrapper bg-gra-02 p-t-130 p-b-100 font-poppins">
        <div class="wrapper wrapper--w680">
            <img  class="card card-4" href="/" src="./static/logo.jpg" style="display: block; margin: 0 auto"></img>
            &nbsp
            <div class="card card-4">
                <div id="canvas" class="card-body">
                </div>
            </div>
        </div>
    </div>

    <!-- Jquery JS-->
    <script src="static/vendor/jquery/jquery.min.js"></script>
    <!-- Vendor JS-->
    <script src="static/vendor/select2/select2.min.js"></script>
    <script src="static/vendor/datepicker/moment.min.js"></script>
    <script src="static/vendor/datepicker/daterangepicker.js"></script>

    <!-- Main JS-->
    <script src="static/js/global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.1.3/pixi.min.js"></script>
    {% block javascript %}
    <script>
        const width = $('#canvas').width()
        const height = $('#canvas').width()
        //const std = window.innerWidth
        const img = new PIXI.Sprite.from("{{url_img}}");
        const depthMap = new PIXI.Sprite.from("{{url_depth}}");
        
        if (width > height){
            setTimeout(app, 500)
        }
        else{
            setTimeout(app2, 500)
        }

        function app(){
            const ratio = depthMap.width / depthMap.height
            console.log(width)
            console.log(ratio)
            console.log(depthMap.height)
            console.log(depthMap.width)
            
            img_ratio = 1
            img.height = height * img_ratio
            img.width = width * img_ratio * ratio
            depthMap.height = height * img_ratio
            depthMap.width = width  * img_ratio * ratio
            console.log(depthMap.height)
            console.log(depthMap.width)
            let app = new PIXI.Application({width: depthMap.width, height: depthMap.height, backgroundColor: 0xffffff, resolution: window.devicePixelRatio || 1});
            document.getElementById('canvas').appendChild(app.view);
            //document.body.appendChild(app.view);
            app.stage.addChild(img);
            app.stage.addChild(depthMap);      
            displacementFilter = new PIXI.filters.DisplacementFilter(depthMap);
            app.stage.filters = [displacementFilter];
            
            window.onmousemove = function(e) {
                displacementFilter.scale.x = (window.innerWidth / 2 - e.clientX) /20;
                displacementFilter.scale.y = (window.innerHeight / 2 - e.clientY) /20;
            };
        };
        function app2(){
            const ratio = depthMap.height / depthMap.width
            console.log(height)
            console.log(ratio)
            console.log(depthMap.height)
            console.log(depthMap.width)
            
            img_ratio = 0.9
            img.width = height * img_ratio 
            img.height = height * img_ratio * ratio
            depthMap.width = height * img_ratio
            depthMap.height = height  * img_ratio  * ratio
            console.log(depthMap.height)
            console.log(depthMap.width)
            let app = new PIXI.Application({width: depthMap.width, height: depthMap.height, backgroundColor: 0xffffff, resolution: window.devicePixelRatio || 1});
            document.getElementById('canvas').appendChild(app.view);
            //document.body.appendChild(app.view);
            app.stage.addChild(img);
            app.stage.addChild(depthMap);      
            displacementFilter = new PIXI.filters.DisplacementFilter(depthMap);
            app.stage.filters = [displacementFilter];
            
            window.onmousemove = function(e) {
                displacementFilter.scale.x = (window.innerWidth / 2 - e.clientX) /20;
                displacementFilter.scale.y = (window.innerHeight / 2 - e.clientY) /20;
            };
        };
    </script>
    {% endblock %}

</body><!-- This templates was made by Colorlib (https://colorlib.com) -->

</html>
<!-- end document-->